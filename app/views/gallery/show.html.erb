<% content_for :header do %>
    <style>
        .album-container .created-date { font-size: 12px; }
        .album-container .add-comment-text { font-size: 25px; }
        .album-container video { width: 100%; }
        .album-container *:focus { outline: none !important; }
    </style>
<% end %>

<% content_for :footer do %>
    <%= javascript_include_tag "masonry.pkgd.min.js" %>
    <%= javascript_include_tag "imagesloaded.pkgd.min.js" %>

    <script>
        $(function() 
        {
            $('.grid', '.album-container container-fluid').each(function() 
            {
                const $grid = $(this).imagesLoaded(function()
                {
                    $grid.masonry({
                        percentPosition: true
                    });
                });
            });
            
        });
    </script>
<% end %>

<div class="album-container container-fluid">
    <section class="py-5 text-center container">
        <div class="row">
            <div class="col">
                <h1 class="fw-light"><%= @album.name %></h1>
                <p class="lead text-muted"><%= @album.description %></p>
            </div>
        </div>
    </section>
    <nav>
        <div class="nav nav-tabs" role="tablist">
            <button class="nav-link active" id="nav-all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab" aria-controls="all" aria-selected="true">All</button>
            <button class="nav-link" id="nav-photos-tab" data-bs-toggle="tab" data-bs-target="#photos" type="button" role="tab" aria-controls="photos" aria-selected="false">Photos</button>
            <button class="nav-link" id="nav-videos-tab" data-bs-toggle="tab" data-bs-target="#videos" type="button" role="tab" aria-controls="videos" aria-selected="false">Videos</button>
        </div>
    </nav>
    <div class="tab-content">
        <div class="tab-pane fade show active p-5" id="all" role="tabpanel" aria-labelledby="nav-all-tab" tabindex="0">
            <div class="row grid">
                <% @album.images.each do |image| %>
                    <div class="col col-sm-6 col-md-4 col-lg-3 mb-4">
                        <figure class="figure mb-0">
                            <% if image.content_type.include?("image") %>
                                <%= image_tag image, loading: 'lazy', class: 'img-thumbnail figure-img' %>
                            <% else %>
                                <%= video_tag url_for(image), size: "350x200", controls: true, controlsList: 'nodownload', preload: 'none', class: 'img-thumbnail figure-img' %>	
                            <% end %>
                        </figure>
                    </div>
                <% end %>
            </div>
        </div>
        <div class="tab-pane fade p-5" id="photos" role="tabpanel" aria-labelledby="nav-photos-tab" tabindex="0">
            <div class="row grid">
                <% @album.images.each do |image| %>
                    <% if image.content_type.include?("image") %>
                        <div class="col col-sm-6 col-md-4 col-lg-3 mb-4">
                            <figure class="figure mb-0">
                                <%= image_tag image, loading: 'lazy', class: 'img-thumbnail figure-img' %>
                            </figure>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>
        <div class="tab-pane fade p-5" id="videos" role="tabpanel" aria-labelledby="nav-videos-tab" tabindex="0">
            <div class="row grid">
                <% @album.images.each do |image| %>
                    <% if image.content_type.include?("video") %>
                        <div class="col col-sm-6 col-md-4 col-lg-3 mb-4">
                            <figure class="figure mb-0">
                                <%= video_tag url_for(image), size: "350x200", controls: true, controlsList: 'nodownload', preload: 'none', class: 'img-thumbnail figure-img' %>	
                            </figure>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>
    </div>

    <section class="comments">
        <h2 class="display-6 my-5 text-center"><%= 'Comments' unless @album.comments.blank? %></h2>
        
        <div class="row justify-content-center">
            <div class="col col-sm-8">
                <ul class="list-group list-group-flush">
                    <% @album.comments.where(:status => 'Public').each do |comment| %>
                        <li class="list-group-item bg-transparent">
                            <div class="d-flex">
                                <div class="flex-shrink-0 d-flex align-items-center">
                                    <span class="rounded-circle text-bg-secondary p-3"><%= icon('fa-solid fa-2xl', 'user') %></span>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h5><%= comment.name %> <span class="created-date h6 text-muted"><i><%= distance_of_time_in_words(comment.created_at, comment.created_at + 50.minutes) %></i></span></h5>
                                    <p><%= comment.body %></p>
                                </div>
                            </div>
                        </li>
                    <% end %>
                </ul>
            </div>        
        </div>

        <h3 class="add-comment-text my-5 text-center">Add a comment</h3>

        <div class="row justify-content-center">
            <div class="col col-sm-8">
                <%= form_with model: [ @album, @album.comments.build ] do |form| %>
                    <div class="mb-3">
                        <%= form.label 'Name', class: 'form-label' %>
                        <%= form.text_field 'name', class: 'form-control' %>
                    </div>
                    <div class="mb-3">
                        <%= form.label 'Message' , class: 'form-label' %>
                        <%= form.text_area :body, rows: '5', class: 'form-control' %>
                    </div>
                    
                    <%= form.hidden_field :status, value: 'Public' %>
                    <%= form.hidden_field :album_id, value: request.fullpath.split("/").last %>

                    <div class="d-grid gap-2">
                        <%= form.submit 'Submit', :class => 'btn btn-primary btn-lg' %>
                    </div>
                <% end %>
            </div>
        </div>
    </section>
</div>